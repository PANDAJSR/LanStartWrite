<style>
  .devtools-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 600px;
    height: 400px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    z-index: 10000;
    font-family: 'Segoe UI', system-ui, sans-serif;
    animation: devtools-fade-in 0.2s ease-out;
  }

  .theme-dark .devtools-window {
    background: rgba(32, 32, 32, 0.95);
    border-color: rgba(255, 255, 255, 0.1);
    color: #fff;
  }

  @keyframes devtools-fade-in {
    from { opacity: 0; transform: translate(-50%, -48%) scale(0.95); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }

  .devtools-header {
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    -webkit-app-region: drag;
  }
  .theme-dark .devtools-header { border-bottom-color: rgba(255, 255, 255, 0.05); }

  .devtools-title {
    font-weight: 600;
    font-size: 14px;
  }

  .devtools-close {
    border: none;
    background: transparent;
    cursor: pointer;
    padding: 8px;
    border-radius: 4px;
    color: inherit;
    -webkit-app-region: no-drag;
  }
  .devtools-close:hover { background: rgba(0, 0, 0, 0.05); }
  .theme-dark .devtools-close:hover { background: rgba(255, 255, 255, 0.05); }

  .devtools-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 16px;
    gap: 16px;
    overflow: hidden;
  }

  .devtools-tabs {
    display: flex;
    gap: 8px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    padding-bottom: 8px;
  }
  .devtools-tab {
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    opacity: 0.7;
  }
  .devtools-tab.active {
    background: rgba(0,0,0,0.05);
    opacity: 1;
    font-weight: 600;
  }
  .theme-dark .devtools-tab.active { background: rgba(255,255,255,0.1); }

  .devtools-panel { display: none; flex: 1; flex-direction: column; gap: 12px; overflow: hidden; }
  .devtools-panel.active { display: flex; }

  .console-output {
    flex: 1;
    background: rgba(0,0,0,0.03);
    border-radius: 4px;
    padding: 8px;
    font-family: monospace;
    font-size: 12px;
    overflow-y: auto;
    white-space: pre-wrap;
  }
  .theme-dark .console-output { background: rgba(0,0,0,0.2); }

  .console-input-row {
    display: flex;
    gap: 8px;
  }
  .console-input {
    flex: 1;
    padding: 8px;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 4px;
    background: transparent;
    color: inherit;
    font-family: monospace;
  }
  .theme-dark .console-input { border-color: rgba(255,255,255,0.1); }
  
  .fluent-btn {
    padding: 6px 16px;
    background: #0067c0;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .fluent-btn:hover { background: #005a9e; }
</style>

<div class="devtools-window">
  <div class="devtools-header">
    <div class="devtools-title">LanStart Developer Tools</div>
    <button class="devtools-close" onclick="Mod.closeOverlay()">âœ•</button>
  </div>
  <div class="devtools-body">
    <div class="devtools-tabs">
      <div class="devtools-tab active" onclick="switchTab('console')">Console</div>
      <div class="devtools-tab" onclick="switchTab('inspector')">Inspector</div>
    </div>
    
    <div id="tab-console" class="devtools-panel active">
      <div id="consoleOutput" class="console-output">Welcome to LanStart DevTools.</div>
      <div class="console-input-row">
        <input id="consoleInput" class="console-input" placeholder="Execute JavaScript..." onkeydown="handleInput(event)" />
        <button class="fluent-btn" onclick="exec()">Run</button>
      </div>
    </div>

    <div id="tab-inspector" class="devtools-panel">
      <div class="console-input-row">
        <input id="inspectorInput" class="console-input" placeholder="CSS Selector (e.g. .floating-panel)" />
        <button class="fluent-btn" onclick="inspect()">Inspect</button>
      </div>
      <div class="console-output">
        Enter a selector to inspect DOM elements.
      </div>
    </div>
  </div>
</div>

<script>
  function switchTab(id) {
    document.querySelectorAll('.devtools-tab').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.devtools-panel').forEach(el => el.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('tab-' + id).classList.add('active');
  }

  function handleInput(e) {
    if (e.key === 'Enter') exec();
  }

  function log(msg, type='info') {
    const out = document.getElementById('consoleOutput');
    const line = document.createElement('div');
    line.textContent = `> ${msg}`;
    line.style.color = type === 'error' ? '#ff6b6b' : 'inherit';
    out.appendChild(line);
    out.scrollTop = out.scrollHeight;
  }

  function exec() {
    const input = document.getElementById('consoleInput');
    const code = input.value;
    if (!code) return;
    
    const reqId = Date.now().toString();
    log(code);
    
    // Send to plugin worker
    // Note: Since this HTML is rendered in main thread (overlay), but 'Mod' available here is the 
    // *renderer* Mod object?
    // Wait, Mod.showOverlay renders HTML in the renderer process.
    // The script tag in this HTML runs in the renderer process context (if inserted via innerHTML/range).
    // HOWEVER, standard innerHTML script tags do not execute.
    // Mod.showOverlay uses `_openOverlay` which might need adjustment to run scripts.
    // Let's check `_openOverlay` in `mod.js`.
    
    // If scripts don't run, we have a problem.
    // We might need to use `on...` attributes (like onclick) which I used.
    // But `handleInput` needs to be defined globally or attached to the element.
    // Since this is just a quick implementation, I'll inline the logic in onclick/onkeydown if needed, 
    // or rely on `Mod.eval` if available in the overlay context.
    
    // Actually, `Mod` in renderer has `publish`.
    // The overlay is just a div in the body.
    // The script tags inside innerHTML won't run automatically.
    // I need to use `Mod.inject` for scripts or assume `ui-tools.js` handles it?
    // `ui-tools.js` `_openOverlay` logic:
    /*
    function _openOverlay(html) {
      // ...
      _overlayEl.innerHTML = html;
      // ...
    }
    */
    // Scripts won't run.
    
    // Workaround: Use `Mod.inject` to inject a script tag, or structure this UI without inline scripts?
    // Or put the script in `main.js` and use `Mod.inject`?
    // But `main.js` is in the worker.
    
    // I will modify `ui.html` to be script-free and use event delegation? 
    // No, that's hard from a worker.
    
    // Better approach:
    // Modify `_openOverlay` in `mod.js` to execute scripts.
    
    Mod.publish('ui-action', { action: 'devtools:eval', code, reqId });
    input.value = '';
  }
  
  function inspect() {
    const sel = document.getElementById('inspectorInput').value;
    Mod.publish('ui-action', { action: 'devtools:inspect', selector: sel });
  }

  // Listen for results
  Mod.on('devtools:eval-result', (msg) => {
    if (msg.result) log(JSON.stringify(msg.result, null, 2));
    if (msg.error) log(msg.error, 'error');
  });
</script>
